# 更新日志

所有此项目的版本变更都将记录在此文件中。

本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范。

## [2.6.0] - 2025-07-24

### ✨ 新增 (Added)
- **智能混合下载模式**: 前端现在可以根据视频是否需要合并，自动选择“流式下载”或“后台任务下载”。
- **UI调色板**: 在 `static/script.js` 中引入了可完全自定义的颜色调色板，可以轻松修改下载选项的颜色。
- **前端域名白名单检查**: 在前端添加了简单的域名白名单检查，为用户提供即时反馈。

### ♻️ 变更 (Changed)
- **统一音频下载策略**: “高比特率”音频下载现在采用“主动策略”，由后端智能选择最佳的 `m4a` 或 `mp4` 格式，提高了对不同视频网站的适应性。
- **优化文件查找逻辑**: 将被动的“文件搜索”升级为主动的“文件验证”，提高了下载后文件定位的可靠性。
- **改进视频格式解析**: 增强了对X.com等网站的视频格式分类，能正确识别并处理预合并的视频文件。
- **优化音频信息显示**: 下载选项现在优先显示音频比特率（kbps）而非文件大小，更直观地反映音质。
- **简化启动脚本**: `start_web_server.py` 被重构为直接使用 `uvicorn.run()`，使进程管理更简单、更可靠。

### 🐞 修复 (Fixed)
- **修复服务器无限重启**: 通过在启动脚本中精确指定监控和排除目录，解决了因日志文件写入导致服务器无限重启的问题。
- **修复端口占用错误**: 简化了启动脚本，确保 `Ctrl+C` 能干净地关闭所有Uvicorn进程，解决了 `Address already in use` 的问题。
- **修复CI/CD流程**:
    - 在 `requirements.txt` 中添加了缺失的 `psutil` 依赖。
    - 在 `web/main.py` 中使用了向后兼容的类型提示（`Union`, `Optional`），解决了在旧版Python上的测试失败问题。
- **修复单元测试**: 更新了 `tests/test_downloader.py`，使其与重构后的代码保持同步。
- **修复语言切换Bug**: 修正了 `static/common.js` 中的 `formatFileSize` 函数，解决了在“未知大小”情况下切换语言时显示错误的问题。
- **清理Celery日志警告**: 通过明确指定 `rich.console` 的输出目标为 `stdout`，清除了Celery Worker日志中不必要的 `WARNING` 信息。
- **清理调试日志**: 移除了Web服务器代码中用于调试的 `print` 语句和冗余日志。
