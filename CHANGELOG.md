# 更新日志

所有此项目的版本变更都将记录在此文件中。

本项目遵循 [语义化版本](https://semver.org/lang/zh-CN/) 规范。

## [2.8.0] - 2025-07-26

### 🐞 修复 (Fixed)
- **修复直流音频下载格式保留**: 解决了直流下载音频文件时强制保存为 `.mp3` 格式的问题，现在能正确保留原始音频格式（m4a、opus、mp4、aac等）
- **统一文件名处理机制**: 统一了直流下载和后台下载的文件名处理逻辑，确保两种下载方式使用相同的命名规则
- **完善Unicode文件名支持**: 
  - 实现RFC 6266标准的HTTP Content-Disposition头部处理
  - 添加智能ASCII备用文件名生成策略
  - 支持中文等Unicode字符的正确显示和下载
- **配置化文件名长度管理**: 使用配置文件中的 `filename_max_length` 设置替代硬编码长度限制
- **优化文件名截断逻辑**: 改进文件名截断算法，优先在标点符号和单词边界处截断，保持文件名的可读性
- **移除硬编码内容映射**: 清理了ASCII备用文件名生成中的硬编码中文关键词映射，使用更通用的字符提取策略

### ♻️ 变更 (Changed)
- **音频格式映射完善**: 为直流下载添加了完整的音频格式到MIME类型的映射表（m4a→audio/mp4, opus→audio/opus等）
- **智能文件名处理**: 
  - 视频文件名包含分辨率信息（如 `视频标题_1920x1080.mp4`）
  - 音频文件名不包含分辨率（如 `音频标题.m4a`）
- **改进错误处理**: 增强了文件名处理过程中的错误处理和日志记录

### 🧹 代码清理 (Code Cleanup)
- **确认代码使用状态**: 验证了web/main.py中766-946行的文件名处理代码均为活跃使用状态，无冗余代码需要清理
